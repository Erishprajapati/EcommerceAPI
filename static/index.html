<!DOCTYPE html>
<html>
<head>
    <title>Ecommerce</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <nav>
        <ul id="navbar" class="navbar">
            <!-- Nav items will be inserted here dynamically -->
        </ul>
    </nav>
    
    <div id="product-list"></div>

<script>
async function fetchAndDisplayProducts() {
try {
    const response = await fetch('/all_products?skip=0&limit=10');
    if (!response.ok) throw new Error('Failed to fetch products');

    const products = await response.json();

    const container = document.getElementById('product-list');
    container.innerHTML = products.map(product => `
    <div class="product-card">
        <h3>${product.name}</h3>
        <img src="${product.image ? '/' + product.image : '/static/images/dwarika.jpg'}" alt="${product.name}" width="150"
            onerror="this.onerror=null;this.src='/static/images/default.jpg';" />
        <p>${product.description}</p>
        <p>Price: $${product.price.toFixed(2)}</p>
        <p>Available: ${product.is_available ? 'Yes' : 'No'}</p>
    </div>
    `).join('');
} catch (error) {
    console.error('Error loading products:', error);
    document.getElementById('product-list').innerText = 'Failed to load products.';
}
}

window.addEventListener('DOMContentLoaded', fetchAndDisplayProducts);
</script>


<script>
    // Simple check for user logged in status (example only)
    function isLoggedIn() {
        return localStorage.getItem('loggedIn') === 'true';
    }

    function renderNavbar() {
        const navbar = document.getElementById('navbar');
        navbar.innerHTML = '';  // Clear existing links

        if (isLoggedIn()) {
            // Logged in view: Add Product + Logout
            navbar.innerHTML = `
                <li><a href="/static/index.html">Home</a></li>
                <li><a href="/static/products.html">Products</a></li>
                <li><a href="/static/add_product.html">Add Product</a></li>
                <li><a href="#" id="logout-link">Logout</a></li>
            `;

            document.getElementById('logout-link').addEventListener('click', function(e) {
                e.preventDefault();
                if (confirm("Are you sure you want to logout?")) {
                    // Clear login flag (or token) from storage
                    localStorage.removeItem('loggedIn');
                    alert("Logout successful!");
                    // Redirect to login page
                    window.location.href = '/static/login.html';
                }
            });

        } else {
            // Not logged in view: Login + Register
            navbar.innerHTML = `
                <li><a href="/static/index.html">Home</a></li>
                <li><a href="/static/products.html">Products</a></li>
                <li><a href="/static/login.html">Login</a></li>
                <li><a href="/static/register.html">Register</a></li>
            `;
        }
    }

    // On page load, render the navbar
    renderNavbar();
</script>
<script src="/frontend/navbar.js"></script>

</body>
</html>
